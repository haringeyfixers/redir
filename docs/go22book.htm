<!DOCTYPE HTML><html lang="en-US"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta property="og:site_name" content="Quick redirects"><meta property="og:title" content="Haringey Fixers" /><meta property="og:description" content="Takes a while to load, please be patient" />
<meta property="og:image" content="https://haringeyfixers.org/2sz/favicons/25/web-app-manifest-512x512.png" />
<link rel="canonical" href="http://haringeyfixers.github.io/redir/go22book.htm" /><meta name="robots" content="noindex,nofollow" />
<title>Haringey Fixers - Booking In</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f4f4f4; }
        .booking-card { 
            background: white; padding: 20px; border-radius: 8px; 
            max-width: 400px; margin: auto; box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
        }
        h2 { color: #333; margin-top: 0; }
        input, select, button { 
            width: 100%; padding: 12px; margin: 8px 0; 
            border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; 
        }
        button { 
            background-color: #28a745; color: white; border: none; 
            font-weight: bold; cursor: pointer; font-size: 16px;
        }
        button:disabled { background-color: #ccc; }
        .hidden { display: none; }
        #message { text-align: center; font-weight: bold; margin-top: 10px; }
    </style>
</head><body>

<div class="booking-card">
    <h2>Repair Booking</h2>
    <p>Please enter your details to book a slot.</p>
    
    <form id="bookingForm">
        <input type="text" id="userName" placeholder="Your Name" required>
        <input type="email" id="userEmail" placeholder="Email Address" required>
        <select id="itemType" required>
            <option value="" disabled selected>What needs fixing?</option>
            <option value="Electronics">Electronics</option>
            <option value="Clothing">Clothing/Textiles</option>
            <option value="Mechanical">Mechanical/General</option>
            <option value="Computers">Laptop/Computer</option>
        </select>
        <button type="submit" id="submitBtn">Confirm Booking</button>
    </form>
    
    <div id="message"></div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-analytics.js";
    // import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    // import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

   const url = "https://script.google.com/macros/s/AKfycbxQC41GE7GW_BehGN1dQUADn8KSWFzuHz2IgcTfJ3qXVY6N1vttvfHh2qLmFYuO-Kgj/exec";

   const getFirebaseConfig = async () => {
    const response = await fetch(url, {
        method: "POST",
        body: JSON.stringify({
            token: "Qgtw9dkO2ABQup1oFfrklVW_blMLwRbJ26DL" // This must match the script exactly
         })
   });
   
   // Fb firebaseConfig 
   const UnusedfirebaseConfig = {
    apiKey: "AIzaSyDoh2cBbbo_rleGZSF9QODh7q4sQdjN3_0",
    authDomain: "activity-db-8b49f.firebaseapp.com",
    projectId: "activity-db-8b49f",
    storageBucket: "activity-db-8b49f.firebasestorage.app",
    messagingSenderId: "108478103688",
    appId: "1:108478103688:web:8b44ea48d9650b4d6d9f3d",
    measurementId: "G-PVWJ80PRM9"
   };
  
  const firebaseConfig = await response.json();
  
  if (firebaseConfig.apiKey) {
    console.log("Success! Firebase Config:", firebaseConfig);
  } else {
    console.error("Failed to fetch config:", firebaseConfig.message);
  }
};

  // Initialize Firebase and Firestore
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  
  const urlParams = new URLSearchParams(window.location.search);
  const currentEvent = urlParams.get('event') || 'General';
// Pass 'currentEvent' into your createBooking function!
  /**
   * Function to save a new booking to the 'bookings' collection
   * @param {string} userName - Name of the person booking
   * @param {string} eventId - The ID of the repair event
   */
  async function createBooking(userName, eventId) {
    try {
      const docRef = await addDoc(collection(db, "bookings"), {
        name: userName,
        event: eventId,
        status: "pending",
        createdAt: serverTimestamp() // Uses Firebase server time, not local user time
      });
      
      console.log("Booking successful! ID:", docRef.id);
      alert("Thank you! Your booking is confirmed.");
      
    } catch (e) {
      console.error("Error adding document: ", e);
      alert("Booking failed. Please check your internet connection.");
    }
  }

  // Example: Expose the function to the window so you can call it from a button
  window.makeBooking = () => {
    const name = prompt("Enter your name:");
    if (name) createBooking(name, "Haringey-Fixers-Feb-2026");
  };

  const form = document.getElementById('bookingForm');
  const msgDiv = document.getElementById('message');
  const btn = document.getElementById('submitBtn');

  // Logic to handle form submission
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    btn.disabled = true;
    btn.innerText = "Saving...";
    msgDiv.innerText = "";

    const bookingData = {
      name: document.getElementById('userName').value,
      email: document.getElementById('userEmail').value,
      item: document.getElementById('itemType').value,
      timestamp: serverTimestamp(),
      status: "waiting"
    };

    try {
      const docRef = await addDoc(collection(db, "bookings"), bookingData);
      
      form.classList.add('hidden');
      msgDiv.innerHTML = `<span style="color: green;">Success! Reference: ${docRef.id}<br>See you at the event!</span>`;
      
    } catch (error) {
      console.error("Error:", error);
      msgDiv.innerHTML = `<span style="color: red;">Error saving booking. Please try again.</span>`;
      btn.disabled = false;
      btn.innerText = "Confirm Booking";
    }
  });
</script>

<button onclick="makeBooking()" style="padding: 10px; margin-top: 20px;">
  Click to Book for Repair Event
</button>
</body></html>
